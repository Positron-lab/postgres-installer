# Postgres Installer

Приложение для установки и настройки PostgreSQL на наименее загруженном из двух удалённых серверов.

Debian
AlmaLinux или совместимая ОС (поддержка systemd + PostgreSQL)
Python 3.6+
SSH доступ по ключу (от исполнителя к целевым серверам)
Открыт порт 22 (SSH) и 5432 (PostgreSQL)


## На целевых серверах

Создать пользователя или использовать существующего
Настроить SSH доступ без пароля (скопировать ключ на целевые сервера)
В /etc/sudoers прописать <user> ALL=(ALL)   NOPASSWD:ALL
Открыть порт 5432, если используется firewall

## На сервере-исполнителе
Проект
|---install_postgres.py
|---requirements.txt
|---ansible/
    |---inventory.ini
    |---install_postgres.yml

## Использование

```bash
python3 install_postgres.py x.x.x.x,y.y.y.y
```

## Зависимости

Установить зависимости:

```bash
pip install -r requirements.txt
```

Также необходим установленный `ansible`.

## Описание

- Подключается к двум серверам по SSH (ключ уже подложен).
- Оценивает нагрузку через `uptime`.
- Выбирает наименее загруженный сервер.
- Устанавливает и настраивает PostgreSQL.
- Разрешает подключения к пользователю `student` только с IP второго сервера.
- Проверяет, отвечает ли PostgreSQL через `SELECT 1`.

## Принятые решения

- Используется `paramiko` для SSH.
- Установка через Ansible.
- Проверка БД с помощью `psycopg2`.

